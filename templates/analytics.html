<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š åˆ†æå ±è¡¨ - Cat Claws è²“å’ªé£Ÿå ‚</title>
  <link rel="icon" href="https://emojipedia-us.s3.dualstack.us-west-1.amazonaws.com/thumbs/240/google/350/cat-face_1f431.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      color: #764ba2;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 1.1em;
    }

    .nav-links {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .nav-link {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      text-decoration: none;
      border-radius: 10px;
      transition: all 0.3s;
    }

    .nav-link:hover {
      background: #764ba2;
      transform: translateY(-2px);
    }

    /* Date Filter */
    .date-filter {
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .date-filter label {
      font-weight: bold;
      color: #764ba2;
    }

    .date-filter input {
      padding: 10px;
      border: 2px solid #667eea;
      border-radius: 10px;
      font-size: 1em;
    }

    .date-filter button {
      padding: 10px 30px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
    }

    .date-filter button:hover {
      background: #764ba2;
      transform: translateY(-2px);
    }

    /* Summary Cards */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
      transition: transform 0.3s;
    }

    .summary-card:hover {
      transform: translateY(-5px);
    }

    .summary-card .icon {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .summary-card .label {
      color: #666;
      font-size: 1em;
      margin-bottom: 10px;
    }

    .summary-card .value {
      font-size: 2em;
      font-weight: bold;
      color: #764ba2;
    }

    /* Chart Grid */
    .chart-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 30px;
      margin-bottom: 30px;
    }

    .chart-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .chart-card.full-width {
      grid-column: 1 / -1;
    }

    .chart-card h2 {
      color: #764ba2;
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .chart-container {
      position: relative;
      height: 400px;
    }

    .chart-container.small {
      height: 300px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      overflow: auto;
    }

    .modal-content {
      background-color: white;
      margin: 50px auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 1200px;
      max-height: 80vh;
      overflow: hidden;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3);
    }

    .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.8em;
    }

    .close-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      transition: all 0.3s;
    }

    .close-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 30px;
      max-height: calc(80vh - 100px);
      overflow-y: auto;
    }

    /* Orders Table */
    .orders-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .orders-table th {
      background: #667eea;
      color: white;
      padding: 15px;
      text-align: left;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .orders-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
    }

    .orders-table tr:hover {
      background-color: #f5f5f5;
    }

    .order-items {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }

    .order-status {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.85em;
      font-weight: bold;
    }

    .status-completed {
      background: #48bb78;
      color: white;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.5em;
      color: white;
    }

    .loading-spinner {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .chart-grid {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 1.8em;
      }

      .date-filter {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>ğŸ“Š Cat Claws è²“å’ªé£Ÿå ‚ - åˆ†æå ±è¡¨</h1>
      <p>å³æ™‚ç‡Ÿé‹æ•¸æ“šåˆ†æèˆ‡æ´å¯Ÿ</p>
      <div class="nav-links">
        <a href="/" class="nav-link">ğŸ  å›åˆ°é¦–é </a>
        <a href="/api/docs" class="nav-link" target="_blank">ğŸ“š API æ–‡ä»¶</a>
      </div>
    </div>

    <!-- Revenue Trend Chart (Highlighted) -->
    <div class="chart-card full-width" style="margin-bottom: 30px;">
      <h2>ğŸ“ˆ æ¯æ—¥ç‡Ÿæ”¶è¶¨å‹¢</h2>
      <div class="chart-container">
        <canvas id="revenueChart"></canvas>
      </div>
    </div>

    <!-- Date Filter -->
    <div class="date-filter">
      <label>ğŸ“… æ—¥æœŸç¯„åœï¼š</label>
      <input type="date" id="startDate">
      <label>åˆ°</label>
      <input type="date" id="endDate">
      <button onclick="updateCharts()">ğŸ” æ›´æ–°å ±è¡¨</button>
      <button onclick="setLast30Days()">ğŸ“† æœ€è¿‘ 30 å¤©</button>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="loading" style="display: none;">
      <div class="loading-spinner"></div>
      <p>è¼‰å…¥è³‡æ–™ä¸­...</p>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="icon">ğŸ’°</div>
        <div class="label">ç¸½ç‡Ÿæ”¶</div>
        <div class="value" id="totalRevenue">NT$ 0</div>
      </div>
      <div class="summary-card">
        <div class="icon">ğŸ“¦</div>
        <div class="label">ç¸½è¨‚å–®æ•¸</div>
        <div class="value" id="totalOrders" style="cursor: pointer; text-decoration: underline;" onclick="showOrdersModal()" title="é»æ“ŠæŸ¥çœ‹è¨‚å–®æ˜ç´°">0</div>
      </div>
      <div class="summary-card">
        <div class="icon">ğŸ’µ</div>
        <div class="label">å¹³å‡å®¢å–®åƒ¹</div>
        <div class="value" id="avgOrderValue">NT$ 0</div>
      </div>
      <div class="summary-card">
        <div class="icon">â°</div>
        <div class="label">å°–å³°æ™‚æ®µ</div>
        <div class="value" id="peakHour">--:00</div>
      </div>
    </div>

    <!-- Charts -->
    <div class="chart-grid">
      <!-- Popular Dishes -->
      <div class="chart-card">
        <h2>ğŸ› ç†±é–€é¤é» Top 10</h2>
        <div class="chart-container">
          <canvas id="dishesChart"></canvas>
        </div>
      </div>

      <!-- Popular Drinks -->
      <div class="chart-card">
        <h2>ğŸ¥¤ ç†±é–€é£²æ–™ Top 10</h2>
        <div class="chart-container">
          <canvas id="drinksChart"></canvas>
        </div>
      </div>

      <!-- Pickup Method Ratio -->
      <div class="chart-card">
        <h2>ğŸª å…§ç”¨ vs å¤–å¸¶</h2>
        <div class="chart-container small">
          <canvas id="pickupChart"></canvas>
        </div>
      </div>

      <!-- Peak Hours -->
      <div class="chart-card">
        <h2>â° æ¯å°æ™‚è¨‚å–®åˆ†å¸ƒ</h2>
        <div class="chart-container">
          <canvas id="peakHoursChart"></canvas>
        </div>
      </div>

      <!-- Ice Level Preferences -->
      <div class="chart-card">
        <h2>ğŸ§Š é£²æ–™å†°åº¦åå¥½</h2>
        <div class="chart-container small">
          <canvas id="iceLevelChart"></canvas>
        </div>
      </div>

      <!-- Sweetness Preferences -->
      <div class="chart-card">
        <h2>ğŸ¯ é£²æ–™ç”œåº¦åå¥½</h2>
        <div class="chart-container small">
          <canvas id="sweetnessChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Orders Modal -->
  <div id="ordersModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“‹ è¨‚å–®æ˜ç´°</h2>
        <button class="close-btn" onclick="closeOrdersModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="ordersTableContainer">
          <p style="text-align: center; padding: 20px;">è¼‰å…¥ä¸­...</p>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/js/analytics.js"></script>
</body>
</html>
